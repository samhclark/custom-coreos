# Garage S3-compatible object storage configuration
# Single-node deployment with no replication
# Documentation: https://garagehq.deuxfleurs.fr/documentation/reference-manual/configuration/

# Storage paths - mounted from ZFS datasets
metadata_dir = "/var/lib/garage/meta"
data_dir = "/var/lib/garage/data"

# Database engine - SQLite is more robust than LMDB for single-node
# (handles unclean shutdowns better)
db_engine = "sqlite"

# Single node: no replication
# WARNING: Data is not redundant - use ZFS snapshots for backup
replication_factor = 1

# Block size for data storage (1 MiB)
# This matches the ZFS recordsize on the data dataset
block_size = "1M"

# Compression level for stored blocks (zstd)
# 1 = fast compression, good for media-heavy workloads
# Set to 0 to let zstd choose default (level 3)
compression_level = 1

# RPC configuration (internal cluster communication)
# For single-node, only localhost matters. RPC is not exposed externally.
rpc_bind_addr = "[::]:3901"
rpc_public_addr = "127.0.0.1:3901"
rpc_secret_file = "/var/lib/garage/rpc_secret"

[s3_api]
# S3 API endpoint
api_bind_addr = "[::]:3900"
s3_region = "garage"
# Virtual-hosted style bucket addressing: <bucket>.s3.i.samhclark.com
root_domain = ".s3.i.samhclark.com"

[s3_web]
# Static website hosting endpoint
bind_addr = "[::]:3902"
root_domain = ".web.garage.i.samhclark.com"
index = "index.html"

[admin]
# Admin API endpoint (for garage CLI and metrics)
# Tokens are generated on first boot and stored in /var/lib/garage/
api_bind_addr = "[::]:3903"
admin_token_file = "/var/lib/garage/admin_token"
metrics_token_file = "/var/lib/garage/metrics_token"
